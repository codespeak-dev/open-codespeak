#!/bin/bash

# Pre-commit hook to remove empty lines with tabs from Python files

# Get list of staged Python files (excluding .venv and other non-project files)
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' | grep -v '\.venv/' | grep -v '__pycache__/')

if [ -z "$staged_files" ]; then
    exit 0
fi

# Use the Python script to clean files
if [ -f "scripts/clean_whitespace.py" ]; then
    echo "Pre-commit: Cleaning empty lines with tabs from Python files..."
    python scripts/clean_whitespace.py $staged_files
    
    # Re-stage the cleaned files
    for file in $staged_files; do
        if [ -f "$file" ]; then
            git add "$file"
        fi
    done
else
    echo "Warning: scripts/clean_whitespace.py not found, skipping whitespace cleanup"
fi

exit 0